# 손 인식 기반 신호등 제어 시스템

이 프로젝트는 **웹캠을 통해 손 동작을 인식**하여 신호등의 **모드를 전환**하고, **LED 주기(시간)를 조절**하는 **인터랙티브 신호등 시스템**입니다.

- **p5.js + ml5.js**: 웹 기반 손 제스처 인식
- **Arduino**: LED 및 TaskScheduler 기반 신호등 제어
- **시리얼 통신**: 웹 ↔ 아두이노 간 실시간 데이터 전송

---

## 아두이노 회로도 
![Image](https://github.com/user-attachments/assets/ed9204aa-1d3a-4554-8ae0-ec2f1d5c6184)

## 아두이노 코드 

![Image](https://github.com/user-attachments/assets/7fb85746-08ad-4f86-8682-0fa2f7755dca)
![Image](https://github.com/user-attachments/assets/f1487f08-0f74-4556-8552-6d2f907e039c)
![Image](https://github.com/user-attachments/assets/a9d46236-db55-442a-9f6c-dcffa473270a)
![Image](https://github.com/user-attachments/assets/fe83af9a-0da8-4ac5-9cb3-7d21cb90de33)
![Image](https://github.com/user-attachments/assets/e7f3471a-78e0-4e65-b0f6-8e9f8928123c)

## 아두이노 코드 설명
이 코드는 **p5.js + ml5.js에서 인식된 손 제스처**를 기반으로, **시리얼 통신을 통해 아두이노의 LED 신호등을 제어**하는 구조로 되어 있습니다.
기존 신호등 제어 코드에 p5로부터 수신 받은 데이터를 바탕으로 추가적인 모드 변경 함수를 생성하여 손 모양을 인식하고 모드 변경 및 LED 주기를 컨트롤 할 수 있는 코드를 추가하였습니다.

모션 인식을 통한 모드의 변경이 가해졌을 때 그 모드를 유지하게 되고 모션 인식을 통한 LED의 주기 변경이 가해졌을 때 아두이노는 현재 task를 종료하고 주기를 업데이트 한 후에 task1부터 실행 할 수 있도록 코드를 구성하였습니다.

### 주요 기능
- **TaskScheduler**를 사용한 LED 제어 (신호등 주기 순차 실행)
- **p5.js로부터 수신된 시리얼 데이터 기반 모드 전환 및 주기 조절**
- **하드웨어 스위치 및 손 모션(ml5.js)** 기반 모드 변경 가능
- **가변 저항을 통한 LED 밝기 조절 (PWM)**
---

## ✅ 주요 기능 요약

### ✋ 모드 제어 (왼손 제스처로만 인식)
| 모드           | 왼손 제스처 설명                         |
|----------------|--------------------------------------------|
| **기본 모드**     | 모든 손가락 펼침 (활짝 핀 손)                |
| **비상 모드**     | **엄지 + 소지**만 펼침                     |
| **주의 모드**     | 모든 손가락 접힘 (주먹)                     |
| **깜빡임 모드**   | **엄지 + 중지 + 약지** 펼침                |

> ⚠️ 왼손만 있을 때만 모드가 인식됩니다. 오른손이 동시에 있을 경우 모드는 감지되지 않습니다.

---

### ⏱ LED 주기 조절 (왼손 + 오른손 조합)
| 조절 대상   | 왼손 제스처 (색상 선택)                  | 오른손 제스처 (주기 조절)            |
|-------------|--------------------------------------------|---------------------------------------|
| **빨간색 LED**    | **엄지** 펼침               | 엄지 따봉 → 증가 / 검지+중지 → 감소 |
| **노란색 LED**    | **엄지 + 검지** 펼침                      | 엄지 따봉 → 증가 / 검지+중지 → 감소 |
| **초록색 LED**    | **검지 + 검지 + 중지** 펼침               | 엄지 따봉 → 증가 / 검지+중지 → 감소 |

- 주기는 **100ms 단위로 조절**되며, 최소값은 100ms입니다.
- 슬라이더로도 수동 조절 가능하며, 실시간 UI 업데이트가 반영됩니다.

---

## p5 코드
![Image](https://github.com/user-attachments/assets/3855a274-d465-44ee-abe0-83ec270c8308)
![Image](https://github.com/user-attachments/assets/b2352525-06ca-4344-9183-a7a1bdd09efd)
![Image](https://github.com/user-attachments/assets/fb44f044-e068-4451-9f84-7a79d49f97aa)

### p5 코드 설명
기존 프로젝트에서 슬라이더를 통하여 LED의 주기를 조절하는 부분에서 업데이트 하여 ml5를 통한 손 인식을 통한 LED의 주기 조절과 모드를 변경 할 수 있는 함수들을 추가함.
모드 변경 모션 인식 혹은 LED의 주기 변경 모션을 하게 되면 해당 값을 시리얼 데이터로 보내서 실질적으로 아두이노가 주기의 업데이트 모드의 변경을 가능하게 함.


## 🔧 시스템 구성

- **프론트엔드**:  
  - `p5.js`, `ml5.js`를 활용한 웹캠 기반 손 인식  
  - 슬라이더, 버튼, 모드/밝기/작업 상태 시각화  
  - 시리얼 포트 연결/해제 기능

- **백엔드 (Arduino)**:  
  - `TaskScheduler`로 신호등 사이클 관리  
  - 수신된 TIME 값에 따라 LED 주기 재설정  
  - 모드 전환에 따른 LED 동작 및 Task 관리

---

## 🧠 주요 흐름도

1. 웹캠으로 양손 인식 → 왼손 제스처로 색상 선택
2. 오른손의 제스처로 선택된 색상의 주기 조절
3. 왼손만 있을 경우 모드 전환 제스처 판별
4. 아두이노로 TIME or MODE 명령 전송
5. 아두이노에서 시리얼 메시지를 처리하고 신호등 동작 변경

---

## 📌 참고

- 손가락 판별은 `keypoints`를 기준으로 y좌표 비교로 판단합니다.
- 손을 비스듬하게 비추거나 뒤집히면 인식률이 떨어질 수 있습니다.
- 웹캠의 해상도와 손 위치에 따라 오작동 가능 → 정중앙, 정면 위치 권장
- 카메라 기준으로 손 바닥이 보일 수 인식을 시켜야지 잘 작동이 됩니다.
---

